# Squirrel é¼ é¬šç®¡è¾“å…¥æ³•é¡¹ç›®æ¶æ„è¯´æ˜

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

Squirrelï¼ˆé¼ é¬šç®¡ï¼‰æ˜¯åŸºäº Rime è¾“å…¥æ³•å¼•æ“çš„ macOS è¾“å…¥æ³•ï¼Œé‡‡ç”¨ Swift + Objective-C æ··åˆå¼€å‘ï¼Œä½¿ç”¨ Input Method Kit æ¡†æ¶å®ç°ã€‚

## ğŸ—ï¸ æ•´ä½“é¡¹ç›®ç»“æ„

```
squirrel/
â”œâ”€â”€ sources/                    # ğŸ¯ æ ¸å¿ƒæºä»£ç ç›®å½•
â”œâ”€â”€ librime/                    # ğŸ“š Rime è¾“å…¥æ³•å¼•æ“ï¼ˆGit å­æ¨¡å—ï¼‰
â”œâ”€â”€ plum/                       # ğŸŒ¸ è¾“å…¥æ–¹æ¡ˆé…ç½®ç®¡ç†å™¨ï¼ˆGit å­æ¨¡å—ï¼‰
â”œâ”€â”€ Sparkle/                    # âœ¨ è‡ªåŠ¨æ›´æ–°æ¡†æ¶ï¼ˆGit å­æ¨¡å—ï¼‰
â”œâ”€â”€ Frameworks/                 # ğŸ“¦ ç¼–è¯‘åçš„æ¡†æ¶æ–‡ä»¶
â”œâ”€â”€ lib/                        # ğŸ“š åŠ¨æ€åº“å’Œæ’ä»¶
â”œâ”€â”€ bin/                        # ğŸ› ï¸ å¯æ‰§è¡Œå·¥å…·
â”œâ”€â”€ data/                       # ğŸ“„ é…ç½®æ–‡ä»¶å’Œæ•°æ®
â”œâ”€â”€ resources/                  # ğŸ¨ åº”ç”¨èµ„æºæ–‡ä»¶
â”œâ”€â”€ Assets.xcassets/           # ğŸ–¼ï¸ å›¾æ ‡èµ„æº
â”œâ”€â”€ package/                    # ğŸ“¦ æ‰“åŒ…ç›¸å…³è„šæœ¬
â”œâ”€â”€ scripts/                    # ğŸ“œ å®‰è£…åè„šæœ¬
â”œâ”€â”€ Squirrel.xcodeproj/        # ğŸ—ï¸ Xcode é¡¹ç›®æ–‡ä»¶
â”œâ”€â”€ Makefile                    # ğŸ”¨ æ„å»ºè„šæœ¬
â”œâ”€â”€ action-install.sh          # ğŸš€ å¿«é€Ÿå®‰è£…è„šæœ¬
â””â”€â”€ å„ç§é…ç½®æ–‡ä»¶...
```

## ğŸ“‚ æ ¸å¿ƒæºä»£ç ç›®å½• (sources/)

### ğŸ¯ åº”ç”¨ç¨‹åºå…¥å£
- **`Main.swift`**
  - åº”ç”¨ç¨‹åºä¸»å…¥å£ç‚¹
  - å®šä¹‰ `@main SquirrelApp` ç»“æ„ä½“
  - é…ç½®ç”¨æˆ·ç›®å½•å’Œåº”ç”¨ç›®å½•è·¯å¾„
  - åˆå§‹åŒ–è¾“å…¥æ³•æœåŠ¡

### ğŸ›ï¸ åº”ç”¨ç¨‹åºç®¡ç†
- **`SquirrelApplicationDelegate.swift`**
  - åº”ç”¨ç¨‹åºç”Ÿå‘½å‘¨æœŸç®¡ç†
  - Sparkle è‡ªåŠ¨æ›´æ–°åŠŸèƒ½é›†æˆ
  - ç”¨æˆ·é€šçŸ¥å¤„ç†
  - Rime API åˆå§‹åŒ–å’Œé…ç½®
  - èœå•æ åŠŸèƒ½å®ç°

### âŒ¨ï¸ è¾“å…¥æ³•æ ¸å¿ƒé€»è¾‘
- **`SquirrelInputController.swift`**
  - è¾“å…¥æ³•æ§åˆ¶å™¨ä¸»ç±»
  - é”®ç›˜äº‹ä»¶å¤„ç†
  - æ–‡æœ¬è¾“å…¥å’Œå€™é€‰è¯ç®¡ç†
  - ä¸ Rime å¼•æ“çš„äº¤äº’
  - è¾“å…¥çŠ¶æ€ç®¡ç†

### ğŸ¨ ç”¨æˆ·ç•Œé¢ç»„ä»¶
- **`SquirrelPanel.swift`**
  - å€™é€‰è¯é¢æ¿çª—å£
  - çª—å£ä½ç½®å’Œæ˜¾ç¤ºç®¡ç†
  - é¢æ¿æ ·å¼é…ç½®

- **`SquirrelView.swift`**
  - å€™é€‰è¯æ˜¾ç¤ºè§†å›¾
  - æ–‡æœ¬æ¸²æŸ“å’Œå¸ƒå±€
  - ç”¨æˆ·äº¤äº’å¤„ç†

- **`SquirrelTheme.swift`**
  - ä¸»é¢˜ç³»ç»Ÿå®ç°
  - é¢œè‰²ã€å­—ä½“ã€æ ·å¼ç®¡ç†
  - ä¸»é¢˜é…ç½®è§£æ

### âš™ï¸ é…ç½®å’Œå·¥å…·
- **`SquirrelConfig.swift`**
  - é…ç½®æ–‡ä»¶è¯»å–å’Œè§£æ
  - è®¾ç½®é¡¹ç®¡ç†
  - é…ç½®å˜æ›´ç›‘å¬

- **`InputSource.swift`**
  - è¾“å…¥æºç®¡ç†
  - è¾“å…¥æ³•åˆ‡æ¢é€»è¾‘
  - ç³»ç»Ÿé›†æˆåŠŸèƒ½

- **`MacOSKeyCodes.swift`**
  - macOS æŒ‰é”®ç å®šä¹‰å’Œæ˜ å°„
  - é”®ç›˜äº‹ä»¶è½¬æ¢
  - ç‰¹æ®Šé”®å¤„ç†

### ğŸ”— æ¡¥æ¥å±‚
- **`BridgingFunctions.swift`**
  - Swift ä¸ C/C++ åº“çš„æ¡¥æ¥å‡½æ•°
  - Rime API åŒ…è£…
  - å†…å­˜ç®¡ç†è¾…åŠ©

- **`Squirrel-Bridging-Header.h`**
  - Objective-C/C å¤´æ–‡ä»¶æ¡¥æ¥
  - å¼•å…¥ Rime API å®šä¹‰
  - ç³»ç»Ÿåº“å£°æ˜

## ğŸ“¦ ä¾èµ–é¡¹å’Œå­æ¨¡å—

### ğŸ“š librime/ (Git å­æ¨¡å—)
- **ä½œç”¨**: Rime è¾“å…¥æ³•å¼•æ“æ ¸å¿ƒåº“
- **åŠŸèƒ½**: 
  - æ‹¼éŸ³ã€æ³¨éŸ³ç­‰è¾“å…¥æ–¹æ¡ˆå¤„ç†
  - è¯å…¸ç®¡ç†å’Œå€™é€‰è¯ç”Ÿæˆ
  - ç”¨æˆ·è¯é¢‘å­¦ä¹ 
- **ç¼–è¯‘äº§ç‰©**: `lib/librime.1.dylib`

### ğŸŒ¸ plum/ (Git å­æ¨¡å—)
- **ä½œç”¨**: è¾“å…¥æ–¹æ¡ˆé…ç½®ç®¡ç†å™¨ï¼ˆä¸œé£ç ´ï¼‰
- **åŠŸèƒ½**:
  - è¾“å…¥æ–¹æ¡ˆä¸‹è½½å’Œå®‰è£…
  - é…ç½®æ–‡ä»¶ç®¡ç†
  - è¯å…¸æ•°æ®æä¾›
- **é‡è¦æ–‡ä»¶**: `bin/rime-install`

### âœ¨ Sparkle/ (Git å­æ¨¡å—)
- **ä½œç”¨**: è‡ªåŠ¨æ›´æ–°æ¡†æ¶
- **åŠŸèƒ½**:
  - åº”ç”¨ç¨‹åºè‡ªåŠ¨æ›´æ–°
  - ç‰ˆæœ¬æ£€æŸ¥å’Œä¸‹è½½
  - ç”¨æˆ·æ›´æ–°æç¤º
- **ç¼–è¯‘äº§ç‰©**: `Frameworks/Sparkle.framework`

## ğŸ› ï¸ æ„å»ºäº§ç‰©ç›®å½•

### ğŸ“š lib/
```
lib/
â”œâ”€â”€ librime.1.dylib           # Rime å¼•æ“åŠ¨æ€åº“
â””â”€â”€ rime-plugins/             # Rime æ’ä»¶ç›®å½•
    â”œâ”€â”€ librime-lua.dylib     # Lua è„šæœ¬æ”¯æŒ
    â”œâ”€â”€ librime-octagram.dylib # å…«è‚¡æ–‡è¯­è¨€æ¨¡å‹
    â””â”€â”€ librime-predict.dylib  # é¢„æµ‹è¾“å…¥
```

### ğŸ› ï¸ bin/
```
bin/
â”œâ”€â”€ rime_deployer           # Rime éƒ¨ç½²å·¥å…·
â”œâ”€â”€ rime_dict_manager       # è¯å…¸ç®¡ç†å·¥å…·
â””â”€â”€ rime-install           # è¾“å…¥æ–¹æ¡ˆå®‰è£…å·¥å…·
```

### ğŸ“„ data/
```
data/
â”œâ”€â”€ squirrel.yaml          # Squirrel ä¸»é…ç½®æ–‡ä»¶
â”œâ”€â”€ opencc/                # ç®€ç¹è½¬æ¢æ•°æ®
â”‚   â”œâ”€â”€ TSCharacters.ocd2  # ç¹ç®€å­—ç¬¦æ˜ å°„
â”‚   â”œâ”€â”€ TSPhrases.ocd2     # ç¹ç®€è¯ç»„æ˜ å°„
â”‚   â””â”€â”€ t2s.json          # è½¬æ¢é…ç½®
â””â”€â”€ plum/                  # è¾“å…¥æ–¹æ¡ˆæ•°æ®
    â”œâ”€â”€ default.yaml       # é»˜è®¤é…ç½®
    â”œâ”€â”€ symbols.yaml       # ç¬¦å·å®šä¹‰
    â”œâ”€â”€ essay.txt          # å…«è‚¡æ–‡è¯­æ–™
    â””â”€â”€ å„ç§è¾“å…¥æ–¹æ¡ˆæ–‡ä»¶...
```

## ğŸ¨ èµ„æºæ–‡ä»¶

### ğŸ–¼ï¸ Assets.xcassets/
- **RimeIcon.appiconset/**: åº”ç”¨ç¨‹åºå›¾æ ‡é›†
  - åŒ…å«å„ç§å°ºå¯¸çš„å›¾æ ‡æ–‡ä»¶ï¼ˆ16x16 åˆ° 1024x1024ï¼‰

### ğŸ“‹ resources/
- **Info.plist**: åº”ç”¨ç¨‹åºä¿¡æ¯é…ç½®
- **InfoPlist.xcstrings**: æœ¬åœ°åŒ–å­—ç¬¦ä¸²ï¼ˆInfo.plistï¼‰
- **Localizable.xcstrings**: åº”ç”¨ç¨‹åºæœ¬åœ°åŒ–å­—ç¬¦ä¸²
- **Squirrel.entitlements**: åº”ç”¨ç¨‹åºæƒé™é…ç½®
- **rime.pdf**: å¸®åŠ©æ–‡æ¡£

## ğŸ”¨ æ„å»ºå’Œéƒ¨ç½²

### ğŸ“œ æ ¸å¿ƒè„šæœ¬
- **`Makefile`**: ä¸»æ„å»ºè„šæœ¬
  - ä¾èµ–é¡¹æ„å»ºç®¡ç†
  - åº“æ–‡ä»¶å¤åˆ¶å’Œé“¾æ¥
  - æ‰“åŒ…å’Œç­¾å

- **`action-install.sh`**: å¿«é€Ÿå®‰è£…è„šæœ¬
  - ä¸‹è½½é¢„ç¼–è¯‘çš„ librime
  - ä¸‹è½½ Sparkle æ¡†æ¶
  - å®‰è£…é»˜è®¤è¾“å…¥æ–¹æ¡ˆ

### ğŸ“¦ package/
- **`make_package`**: åˆ›å»ºå®‰è£…åŒ…
- **`sign_app`**: åº”ç”¨ç¨‹åºç­¾å
- **`add_data_files`**: æ·»åŠ æ•°æ®æ–‡ä»¶åˆ°åº”ç”¨åŒ…

### ğŸ“œ scripts/
- **`postinstall`**: å®‰è£…åè„šæœ¬
  - æ³¨å†Œè¾“å…¥æ³•
  - è®¾ç½®æƒé™

## ğŸƒâ€â™‚ï¸ å¼€å‘å·¥ä½œæµ

### 1. ç¯å¢ƒå‡†å¤‡
```bash
# åˆå§‹åŒ–å­æ¨¡å—
git submodule update --init --recursive

# å¿«é€Ÿå®‰è£…ä¾èµ–
bash ./action-install.sh
```

### 2. ç¼–è¯‘é¡¹ç›®
```bash
# ä½¿ç”¨ Make æ„å»º
make release

# æˆ–åœ¨ Xcode ä¸­æ„å»º
open Squirrel.xcodeproj
```

### 3. ä¸»è¦å¼€å‘æ–‡ä»¶
- æ ¸å¿ƒé€»è¾‘ä¿®æ”¹: `sources/SquirrelInputController.swift`
- UI ç•Œé¢ä¿®æ”¹: `sources/SquirrelPanel.swift`, `sources/SquirrelView.swift`
- ä¸»é¢˜æ ·å¼ä¿®æ”¹: `sources/SquirrelTheme.swift`
- é…ç½®ç®¡ç†ä¿®æ”¹: `sources/SquirrelConfig.swift`

## ğŸ” æŠ€æœ¯æ ˆ

- **ä¸»è¦è¯­è¨€**: Swift 5.0
- **UI æ¡†æ¶**: AppKit (macOS)
- **è¾“å…¥æ³•æ¡†æ¶**: Input Method Kit
- **è‡ªåŠ¨æ›´æ–°**: Sparkle Framework
- **è¾“å…¥å¼•æ“**: Rime (C++)
- **æ„å»ºç³»ç»Ÿ**: Xcode + Make
- **åŒ…ç®¡ç†**: Git Submodules

## ğŸ“ é…ç½®æ–‡ä»¶è¯´æ˜

### ä¸»è¦é…ç½®æ–‡ä»¶
- **`data/squirrel.yaml`**: Squirrel åº”ç”¨ç¨‹åºé…ç½®
- **`data/plum/default.yaml`**: Rime é»˜è®¤é…ç½®
- **`resources/Info.plist`**: åº”ç”¨ç¨‹åºå…ƒæ•°æ®

### ç”¨æˆ·é…ç½®ç›®å½•
- **`~/Library/Rime/`**: ç”¨æˆ·ä¸ªäººé…ç½®å’Œæ•°æ®
  - `default.custom.yaml`: ç”¨æˆ·è‡ªå®šä¹‰é…ç½®
  - `squirrel.custom.yaml`: Squirrel è‡ªå®šä¹‰é…ç½®
  - å„ç§ç”¨æˆ·è¯å…¸å’Œæ—¥å¿—æ–‡ä»¶

---

ğŸ“… **æ–‡æ¡£ç”Ÿæˆæ—¶é—´**: 2025å¹´8æœˆ20æ—¥  
ğŸ“ **ç»´æŠ¤è¯´æ˜**: æœ¬æ–‡æ¡£åŸºäºå½“å‰é¡¹ç›®ç»“æ„ç”Ÿæˆï¼Œå¦‚æœ‰å˜æ›´è¯·åŠæ—¶æ›´æ–°
